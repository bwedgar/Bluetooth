<!DOCTYPE html>

<html>

<head>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="apple-touch-icon" href="launch.png">
  <link rel="apple-touch-startup-image" href="launch.png">

  <link rel="canonical" href="https://bwedgar.github.io/Bluetooth" />

  <title>Bluetooth</title>
  <meta name="apple-mobile-web-app-title" content="Bluetooth">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">


  <meta http-equiv="refresh" content="600">
  <style>
    .button1 {
      background-color: black; //#4CAF50;
      /* Green */
      width: 20%;
      border: 2px solid white;
      color: white;
      padding: 15px 32px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
    }
  </style>

</head>

<body style="background-color:black;color:red;font-family:courier;font-size:40px;text-align:center;>
  <div style=" font-size:300px;border: 6px solid red;border-radius: 100px;margin:auto;width:75%">T</div>
  <div><br>Bluetooth by <a style="color:red;" href="https://bwedgar.github.io">bwedgar</a></div>
  <br>
  <button id="find">find bluetooth MyESP32 6</button>
  <BR>
  <button id="codeDisplay" class="button1">code</button><br>
  <button class="button1">X0</button>
  <button id="e0Stopped" class="button1">Stopped</button>
  <button id="e0Reverse" class="button1">Reverse</button>
  <button id="e0LightsOff" class="button1">Lights off</button>
  <button id="L0Button" class="button1">L0</button>
    <button id="L1Button" class="button1">L1</button>
      <button id="L2Button" class="button1">L2</button>

  <script>
    /*
CODING BYTE SENT TO CONTROLLER
engines/coaches  0NNNSRL   NNN=engine number 0-15 S = Stopped or Moving R=Reverse or Forward L=Lights Off or on
lights on frame  11NN NNNL   NNNN=light number 0-31  L=light Off or On
  lights numbers
    L0. scene 0
    L1. scene 1
    L2. scene 2
    L3. scene 3
    L4. scene 4
    L5. scene 5
    L6. scene 6
    L7. scene 7
    L8. sunrise on left
    L9. sunlight 0
    L10. sunlight 1
    L11. sunlight 2
    L12. sunset on right


motors on frame  10NN NNNM   NNNN=motor number 0-31  M=Motor Position 0 or 1
   motor numbers
    M0. actuator 0
    M1. actuator 1
    M2. actuator 2
    M3. actuator 3
    M4. actuator 4
    M5. actuator 5
    M6. actuator 6
    M7. actuator 7
    M8. loop 0 connect
    M9. loop 1 connect
    M10. loop 2 connect
    M11. loop 3 connect
    M12. lift
    M13. loops exit stop
    M14. LHS lift stop
    M15. RHS lift stop




    */
    var time = 0; //time (0-24*4-1) divided 4 gives hours on 24 hours clock advances every 30 secs so day takes 48 minutes
    var sequence=[[40,L0,1]];  //[time,item,state(on or off)]


  sendLightCode = (lightNumber,on) => {
    codeDisplay.innerHTML=(128+64+lightNumber*2+on).toString(2);
  }
    var codeDisplay = document.getElementById("codeDisplay");
    var engineCodes = [
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0]
    ]; //0=stopped,0=reverse,0=lights off
    sendEngineCode = (engineNumber) => {
      codeDisplay.innerHTML = (engineNumber*8+engineCodes[engineNumber][0]*4+engineCodes[engineNumber][1]*2+engineCodes[engineNumber][2]*1).toString(2);
    }
    var myCharacteristic;
    var e0Stopped = document.getElementById("e0Stopped");
    e0Stopped.addEventListener('click', () => {

      engineCodes[0][0] = (engineCodes[0][0] + 1) % 2
      engineCodes[0][0] == 1 ? e0Stopped.innerHTML = 'Moving' : e0Stopped.innerHTML = 'Stopped';
      sendEngineCode(0);
    })
    var e0Reverse = document.getElementById("e0Reverse");
    e0Reverse.addEventListener('click', () => {
      engineCodes[0][1] = (engineCodes[0][1] + 1) % 2;
      engineCodes[0][1] == 1 ? e0Reverse.innerHTML = 'Forward' : e0Reverse.innerHTML = 'Reverse';
      sendEngineCode(0);
    })
    var e0LightsOff = document.getElementById("e0LightsOff");
    e0LightsOff.addEventListener('click', () => {
      engineCodes[0][2] = (engineCodes[0][2] + 1) % 2;
      engineCodes[0][2] == 1 ? e0LightsOff.innerHTML = 'Lights On' : e0LightsOff.innerHTML = 'Lights Off';
      sendEngineCode(8);
    })

    /******************LIGHTS**************/
    var L0=0;
    var L0Button = document.getElementById("L0Button");
    L0Button.addEventListener('click', () => {
      L0=(L0+1)%2;
      L0 == 1 ? L0Button.innerHTML = 'L0 On' : L0Button.innerHTML = 'L0 Off';
      sendLightCode(0,L0);
    })
    var L1=0;
    var L1Button = document.getElementById("L1Button");
    L1Button.addEventListener('click', () => {
      L1=(L1+1)%2;
      L1 == 1 ? L1Button.innerHTML = 'L1 On' : L1Button.innerHTML = 'L1 Off';
      sendLightCode(1,L1);
    })
    var L2=0;
    var L2Button = document.getElementById("L2Button");
    L2Button.addEventListener('click', () => {
      L2=(L2+1)%2;
      L2 == 1 ? L2Button.innerHTML = 'L2 On' : L2Button.innerHTML = 'L2 Off';
      sendLightCode(2,L2);
    })
    var L3=0;
    var L3Button = document.getElementById("L3Button");
    L3Button.addEventListener('click', () => {
      L3=(L3+1)%2;
      L3 == 1 ? L3Button.innerHTML = 'L3 On' : L3Button.innerHTML = 'L3 Off';
      sendLightCode(3,L3);
    })






    var x = document.getElementById("find");






    /*document.getElementById("pin2ON").addEventListener('click', function() {
      myCharacteristic.writeValue(new Uint8Array([0x01]))
    })
    document.getElementById("pin2OFF").addEventListener('click', function() {
      myCharacteristic.writeValue(new Uint8Array([0x02]))
    })





*/
    x.addEventListener('click', function(event) {

      navigator.bluetooth.requestDevice({
          filters: [{
            namePrefix: 'MyESP32'
          }],
          optionalServices: ['4fafc201-1fb5-459e-8fcc-c5c9c331914b']
        })
        //  });



        .then(function(device) {
          // Step 2: Connect to it
          console.log("connecting to device");
          return device.gatt.connect();

        })

        .then(function(server) {
          // Step 3: Get the Service
          console.log("connecting to service");
          return server.getPrimaryService('4fafc201-1fb5-459e-8fcc-c5c9c331914b');

        })

        .then(function(service) {
          // Step 4: get the Characteristic
          console.log("getting characteristic");
          return service.getCharacteristic('beb5483e-36e1-4688-b7f5-ea07361b26a8');

        })
        .then(function(characteristic) {
          myCharacteristic = characteristic;
          // Step 5: Write to the characteristic
          var data = new Uint8Array([0x01]);
          console.log("writing to characteristic");

          return characteristic.writeValue(data);
        })
        .catch(function(error) {
          // And of course: error handling!
          console.error('Connection failed!', error);
        });


    });
  </script>

</body>

</html>
