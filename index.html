<!DOCTYPE html>

<html>

<head>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="apple-touch-icon" href="launch.png">
  <link rel="apple-touch-startup-image" href="launch.png">

  <link rel="manifest" href="manifest.json">
  <link rel="canonical" href="https://bwedgar.github.io/Bluetooth" />

  <title>Bluetooth</title>
  <meta name="apple-mobile-web-app-title" content="Bluetooth">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">


  <meta http-equiv="refresh" content="600">

</head>

<body style="background-color:black;color:red;font-family:courier;font-size:40px;text-align:center;>
  <div style="font-size:300px;border: 6px solid red;border-radius: 100px;margin:auto;width:75%">T</div>
  <div><br>Bluetooth by <a style="color:red;" href="https://bwedgar.github.io">bwedgar</a></div>
  <br>
  <button id="find">find bluetooth MyESP32 1</button>

  <script>
    var x = document.getElementById("find");

    x.addEventListener('click', function(event) {

        navigator.bluetooth.requestDevice({
          filters: [{
            namePrefix: 'MyESP32'
          }],
          optionalServices: [0xff0f]
        })
      //  });



        .then(function(device) {
          // Step 2: Connect to it

          return device.gatt.connect();
            console.log("connected to device");
        })

        .then(function(server) {
          // Step 3: Get the Service
          return server.getPrimaryService('4FAFC201-1FB5-459E-8FCC-C5C9C331914B');
          console.log("service");
        })
        /*
        .then(function(service) {
          // Step 4: get the Characteristic
          return service.getCharacteristic(BEB5483E-36E1-4688-B7F5-EA07361B26A8);
        })
        .then(function(characteristic) {
          // Step 5: Write to the characteristic
          var data = new Uint8Array([0xbb, 0x25, 0x05, 0x44]);
          return characteristic.writeValue(data);
        })
        .catch(function(error) {
           // And of course: error handling!
           console.error('Connection failed!', error);
        });


      let device = navigator.bluetooth.requestDevice({
        filters: [{
          namePrefix: 'MyESP32'
        }],
        optionalServices: [0xff0f]
      });
    });

    navigator.bluetooth.requestDevice({ filters: [{ services: ['battery_service'] }] })
.then(device => device.gatt.connect())
.then(server => {
  // Getting Battery Service…
  return server.getPrimaryService('battery_service');
})
.then(service => {
  // Getting Battery Level Characteristic…
  return service.getCharacteristic('battery_level');
})
.then(characteristic => {
  // Reading Battery Level…
  return characteristic.readValue();
})
.then(value => {
  console.log(`Battery percentage is ${value.getUint8(0)}`);
})
.catch(error => { console.error(error); });
*/
});

  </script>

</body>

</html>
