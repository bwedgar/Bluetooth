<!DOCTYPE html>

<html>

<head>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="apple-touch-icon" href="launch.png">
  <link rel="apple-touch-startup-image" href="launch.png">

  <link rel="canonical" href="https://bwedgar.github.io/Bluetooth" />

  <title>Bluetooth</title>
  <meta name="apple-mobile-web-app-title" content="Bluetooth">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">


  <meta http-equiv="refresh" content="600">
  <style>
    .button1 {
      background-color: black; //#4CAF50;
      /* Green */
      width: 20%;
      border: 2px solid white;
      color: white;
      padding: 15px 32px;
      text-align: center;
      text-decoration: none;
      float: left;
      border: 1px solid green;
      display: inline-block;
      font-size: 16px;
    }

    .button2 {
      background-color: black; //#4CAF50;
      /* Green */
      width: 10%;
      border: 2px solid white;
      color: white;
      padding: 15px 3px;
      text-align: center;
      text-decoration: none;
      //  display: inline-block;
      float: left;
      border: 1px solid green;
      font-size: 16px;
    }

    .button2On {

      background-color: grey; //#4CAF50;
      /* Green */
      width: 10%;
      border: 2px solid white;
      color: black;
      padding: 15px 3px;
      text-align: center;
      text-decoration: none;
      //  display: inline-block;
      float: left;
      border: 1px solid green;
      font-size: 16px;

    }
  </style>

</head>

<body style="background-color:black;color:red;font-family:courier;font-size:40px;text-align:center;>
  <div style=" font-size:300px;border: 6px solid red;border-radius: 100px;margin:auto;width:75%">T</div>
  <div><br>Bluetooth by <a style="color:red;" href="https://bwedgar.github.io">bwedgar</a></div>
  <br>
  <button id="find">find bluetooth MyESP32 6</button>
  <BR>
  <button id="codeDisplay" class="button1">code</button>
  <br style="clear:both" />
  <button class="button1">X0</button>
  <button id="E0MotionButton" class="button1">Stopped</button>
  <button id="E0DirectionButton" class="button1">Reverse</button>
  <button id="E0LightsButton" class="button1">Lights off</button>
  <br style="clear:both" />

  <span>
    <button name="light" id="L0Button" class="button2">L0</button>
    <button name="light" id="L1Button" class="button2">L1</button>
    <button name="light" id="L2Button" class="button2">L2</button>
    <button name="light" id="L3Button" class="button2">L3</button>
    <button name="light" id="L4Button" class="button2">L4</button>
    <button name="light" id="L5Button" class="button2">L5</button>
    <button name="light" id="L6Button" class="button2">L6</button>
    <button name="light" id="L7Button" class="button2">L7</button>
  </span>
  <br style="clear:both" />
  <span>
    <button name="motor" id="M0Button" class="button2">M0</button>
    <button name="motor" id="M1Button" class="button2">M1</button>
    <button name="motor" id="M2Button" class="button2">M2</button>
    <button name="motor" id="M3Button" class="button2">M3</button>
    <button name="motor" id="M4Button" class="button2">M4</button>
    <button name="motor" id="M5Button" class="button2">M5</button>
  <button name="motor" id="M6Button" class="button2">M6</button>
    <button name="motor" id="M7Button" class="button2">M7</button>
  </span>
    <br style="clear:both" />
  <span>
    <button name="motor" id="M0BButton" class="button2">M0</button>
    <button name="motor" id="M1BButton" class="button2">M1</button>
    <button name="motor" id="M2BButton" class="button2">M2</button>
    <button name="motor" id="M3BButton" class="button2">M3</button>
    <button name="motor" id="M4BButton" class="button2">M4</button>
    <button name="motor" id="M5BButton" class="button2">M5</button>
  <button name="motor" id="M6BButton" class="button2">M6</button>
    <button name="motor" id="M7BButton" class="button2">M7</button>
  </span>

  <script>
        var myCharacteristic;

    /*
CODING BYTE SENT TO CONTROLLER
engines/coaches  0NNNSRL   NNN=engine number 0-15 S = Stopped or Moving R=Reverse or Forward L=Lights Off or on
lights on frame  11NN NNNL   NNNN=light number 0-31  L=light Off or On   count=12
*/
    lightNames = [
      "scene 0",
      "scene1",
      "scene2",
      "scene3",
      "sunrise",
      "daytime",
      "sunset"
    ];



    /*  motors on frame 10 NN NNNM NNNN = motor number 0 - 31 M = Motor Position 0 or 1  Count=16
     */

    motorNames = [
      "actuator 0 and LHS+RHS",
      "actuator 1 and loop0 connect",
      "actuator 2 and loop1 connect",
      "actuator 3 and loop2 connect",
      "actuator 4 and loops direction and stop",
      "actuator 5",
      "lift"
    ];

    var time = 0; //time (0-24*4-1) divided 4 gives hours on 24 hours clock advances every 30 secs so day takes 48 minutes
    var sequence = [
      [40, L0, 1]
    ]; //[time,item,state(on or off)]

sendCode=(code)=>{
  v=new Uint8Array(1);
  v[0]=code;
    myCharacteristic.writeValue(v);
}

    sendLightCode = (lightNumber, on) => {
      codeDisplay.innerHTML = (128 + 64 + lightNumber * 2 + on).toString(2).padStart(8, "0");
      code2=128 + 64 + lightNumber * 2 + on;
      console.log(code2);
      sendCode(code2)
    }
    sendMotorCode = (motorNumber, on) => {
      codeDisplay.innerHTML = (128 + 0 + motorNumber * 2 + on).toString(2).padStart(8, "0");
      code2=(128 + 0 + motorNumber * 2 + on);
      console.log(code2);
      sendCode(code2);
    }
    var codeDisplay = document.getElementById("codeDisplay");
    var engineCodes = [
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0]
    ]; //0=stopped,0=reverse,0=lights off
    sendEngineCode = (engineNumber) => {
      codeDisplay.innerHTML = (engineNumber * 8 + engineCodes[engineNumber][0] * 4 + engineCodes[engineNumber][1] * 2 + engineCodes[engineNumber][2] * 1).toString(2).padStart(8, "0");
code2=(engineNumber * 8 + engineCodes[engineNumber][0] * 4 + engineCodes[engineNumber][1] * 2 + engineCodes[engineNumber][2] * 1)
console.log(code2);
sendCode(code2);

    }




    var E0Motion = document.getElementById("E0MotionButton");
    E0Motion.addEventListener('click', () => {

      engineCodes[0][0] = (engineCodes[0][0] + 1) % 2
      engineCodes[0][0] == 1 ? E0Motion.innerHTML = 'Moving' : E0Motion.innerHTML = 'Stopped';
      sendEngineCode(0);
    })
    var E0Direction = document.getElementById("E0DirectionButton");
    E0Direction.addEventListener('click', () => {
      engineCodes[0][1] = (engineCodes[0][1] + 1) % 2;
      engineCodes[0][1] == 1 ? E0Direction.innerHTML = 'Forward' : E0Direction.innerHTML = 'Reverse';
      sendEngineCode(0);
    })
    var E0Lights = document.getElementById("E0LightsButton");
    E0Lights.addEventListener('click', () => {
      engineCodes[0][2] = (engineCodes[0][2] + 1) % 2;
      engineCodes[0][2] == 1 ? E0Lights.innerHTML = 'Lights On' : E0Lights.innerHTML = 'Lights Off';
      sendEngineCode(0);
    })

    /******************LIGHTS**************/
    var L0 = 0;
    var L0Button = document.getElementById("L0Button");
    L0Button.addEventListener('click', () => {
      L0 = (L0 + 1) % 2;
      //  L0 == 1 ? L0Button.innerHTML = 'L0 On' : L0Button.innerHTML = 'L0 Off';
      L0 == 1 ? L0Button.className = "button2On" : L0Button.className = "button2"
      sendLightCode(0, L0);
    })
    var L1 = 0;
    var L1Button = document.getElementById("L1Button");
    L1Button.addEventListener('click', () => {
      L1 = (L1 + 1) % 2;
      L1 == 1 ? L1Button.className = "button2On" : L1Button.className = "button2"
      sendLightCode(1, L1);
    })
    var L2 = 0;
    var L2Button = document.getElementById("L2Button");
    L2Button.addEventListener('click', () => {
      L2 = (L2 + 1) % 2;
      L2 == 1 ? L2Button.className = "button2On" : L2Button.className = "button2"
      sendLightCode(2, L2);
    })
    var L3 = 0;
    var L3Button = document.getElementById("L3Button");
    L3Button.addEventListener('click', () => {
      L3 = (L3 + 1) % 2;
      L3 == 1 ? L3Button.className = "button2On" : L3Button.className = "button2"
      sendLightCode(3, L3);
    })
    var L4 = 0;
    var L4Button = document.getElementById("L4Button");
    L4Button.addEventListener('click', () => {
      L4 = (L4 + 1) % 2;
      L4 == 1 ? L4Button.className = "button2On" : L4Button.className = "button2"
      sendLightCode(4, L4);
    })
    var L5 = 0;
    var L5Button = document.getElementById("L5Button");
    L5Button.addEventListener('click', () => {
      L5 = (L5 + 1) % 2;
      L5 == 1 ? L5Button.className = "button2On" : L5Button.className = "button2"
      sendLightCode(5, L5);
    })
    var L6 = 0;
    var L6Button = document.getElementById("L6Button");
    L6Button.addEventListener('click', () => {
      L6 = (L6 + 1) % 2;
      L6 == 1 ? L6Button.className = "button2On" : L6Button.className = "button2"
      sendLightCode(6, L6);
    })
    var L7 = 0;
    var L7Button = document.getElementById("L7Button");
    L7Button.addEventListener('click', () => {
      L7 = (L7 + 1) % 2;
      L7 == 1 ? L7Button.className = "button2On" : L7Button.className = "button2"
      sendLightCode(7, L7);
    })


    /***************MOTORS******************/
    var M0 = 0;
    var M0Button = document.getElementById("M0Button");
    M0Button.addEventListener('click', () => {
      M0 = (M0 + 1) % 2;
    //  M0 == 1 ? M0Button.className = "button2On" : M0Button.className = "button2";
      sendMotorCode(0, 0);
    })
    var M1 = 0;
    var M1Button = document.getElementById("M1Button");
    M1Button.addEventListener('click', () => {
      M1 = (M1 + 1) % 2;
    //  M1 == 1 ? M1Button.className = "button2On" : M1Button.className = "button2";
      sendMotorCode(1, 0);
    })
    var M2 = 0;
    var M2Button = document.getElementById("M2Button");
    M2Button.addEventListener('click', () => {
      M2 = (M2 + 1) % 2;
    //  M2 == 1 ? M2Button.className = "button2On" : M2Button.className = "button2";
      sendMotorCode(2, 0);
    })
    var M3 = 0;
    var M3Button = document.getElementById("M3Button");
    M3Button.addEventListener('click', () => {
      M3 = (M3 + 1) % 2;
    //  M3 == 1 ? M3Button.className = "button2On" : M3Button.className = "button2";
      sendMotorCode(3, 0);
    })
    var M4 = 0;
    var M4Button = document.getElementById("M4Button");
    M4Button.addEventListener('click', () => {
      M4 = (M4 + 1) % 2;
    //  M4 == 1 ? M4Button.className = "button2On" : M4Button.className = "button2";
      sendMotorCode(4, 0);
    })
    var M5 = 0;
    var M5Button = document.getElementById("M5Button");
    M5Button.addEventListener('click', () => {
      M5 = (M5 + 1) % 2;
  //    M5 == 1 ? M5Button.className = "button2On" : M5Button.className = "button2";
      sendMotorCode(5, 0);
    })
    var M6 = 0;
    var M6Button = document.getElementById("M6Button");
    M6Button.addEventListener('click', () => {
      M6 = (M6 + 1) % 2;
    //  M6 == 1 ? M6Button.className = "button2On" : M6Button.className = "button2";
      sendMotorCode(6, 0);
    })
    var M7 = 0;
    var M7Button = document.getElementById("M7Button");
    M6Button.addEventListener('click', () => {
    //  M6 = (M6 + 1) % 2;
    //  M6 == 1 ? M6Button.className = "button2On" : M6Button.className = "button2";
      sendMotorCode(7, 0);
    })

    /***************MOTORS******************/
    var M0 = 0;
    var M0Button = document.getElementById("M0BButton");
    M0Button.addEventListener('click', () => {
      M0 = (M0 + 1) % 2;
    //  M0 == 1 ? M0Button.className = "button2On" : M0Button.className = "button2";
      sendMotorCode(0, 1);
    })
    var M1 = 0;
    var M1Button = document.getElementById("M1BButton");
    M1Button.addEventListener('click', () => {
      M1 = (M1 + 1) % 2;
    //  M1 == 1 ? M1Button.className = "button2On" : M1Button.className = "button2";
      sendMotorCode(1, 1);
    })
    var M2 = 0;
    var M2Button = document.getElementById("M2BButton");
    M2Button.addEventListener('click', () => {
      M2 = (M2 + 1) % 2;
    //  M2 == 1 ? M2Button.className = "button2On" : M2Button.className = "button2";
      sendMotorCode(2, 1);
    })
    var M3 = 0;
    var M3Button = document.getElementById("M3BButton");
    M3Button.addEventListener('click', () => {
      M3 = (M3 + 1) % 2;
    //  M3 == 1 ? M3Button.className = "button2On" : M3Button.className = "button2";
      sendMotorCode(3, 1);
    })
    var M4 = 0;
    var M4Button = document.getElementById("M4BButton");
    M4Button.addEventListener('click', () => {
      M4 = (M4 + 1) % 2;
    //  M4 == 1 ? M4Button.className = "button2On" : M4Button.className = "button2";
      sendMotorCode(4, 1);
    })
    var M5 = 0;
    var M5Button = document.getElementById("M5BButton");
    M5Button.addEventListener('click', () => {
      M5 = (M5 + 1) % 2;
  //    M5 == 1 ? M5Button.className = "button2On" : M5Button.className = "button2";
      sendMotorCode(5, 1);
    })
    var M6 = 0;
    var M6Button = document.getElementById("M6BButton");
    M6Button.addEventListener('click', () => {
      M6 = (M6 + 1) % 2;
    //  M6 == 1 ? M6Button.className = "button2On" : M6Button.className = "button2";
      sendMotorCode(6, 1);
    })
    var M7 = 0;
    var M7Button = document.getElementById("M7BButton");
    M6Button.addEventListener('click', () => {
    //  M6 = (M6 + 1) % 2;
    //  M6 == 1 ? M6Button.className = "button2On" : M6Button.className = "button2";
      sendMotorCode(7, 1);
    })

    var x = document.getElementById("find");

    /*document.getElementById("pin2ON").addEventListener('click', function() {
      myCharacteristic.writeValue(new Uint8Array([0x01]))
    })
    document.getElementById("pin2OFF").addEventListener('click', function() {
      myCharacteristic.writeValue(new Uint8Array([0x02]))
    })

*/
    x.addEventListener('click', function(event) {

      navigator.bluetooth.requestDevice({
          filters: [{
            namePrefix: 'MyESP32'
          }],
          optionalServices: ['4fafc201-1fb5-459e-8fcc-c5c9c331914b']
        })
        //  });



        .then(function(device) {
          // Step 2: Connect to it
          console.log("connecting to device");
          return device.gatt.connect();

        })

        .then(function(server) {
          // Step 3: Get the Service
          console.log("connecting to service");
          return server.getPrimaryService('4fafc201-1fb5-459e-8fcc-c5c9c331914b');

        })

        .then(function(service) {
          // Step 4: get the Characteristic
          console.log("getting characteristic");
          return service.getCharacteristic('beb5483e-36e1-4688-b7f5-ea07361b26a8');

        })
        .then(function(characteristic) {
          myCharacteristic = characteristic;
          // Step 5: Write to the characteristic
          var data = new Uint8Array([0x41]);
          console.log("writing to characteristic");

          return characteristic.writeValue(data);
        })
        .catch(function(error) {
          // And of course: error handling!
          console.error('Connection failed!', error);
        });


    });
  </script>

</body>

</html>
